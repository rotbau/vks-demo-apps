apiVersion: cluster.x-k8s.io/v1beta1
kind: Cluster
#define the cluster
metadata:
  #user-defined name of the cluster; string
  name: cluster-default
  #kubernetes namespace for the cluster; string
  namespace: tkg-cluster-ns
#define the desired state of cluster
spec:
  #specify the cluster network; required, there is no default
  clusterNetwork:
    #network ranges from which service VIPs are allocated
    services:
      #ranges of network addresses; string array
      #CAUTION: must not overlap with Supervisor
      cidrBlocks: ["10.96.0.0/12"]
    #network ranges from which Pod networks are allocated
    pods:
      #ranges of network addresses; string array
      #CAUTION: must not overlap with Supervisor
      cidrBlocks: ["192.168.0.0/16"]
    #domain name for services; string
    serviceDomain: "cluster.local"
  #specify the topology for the cluster
  topology:
    #name of the ClusterClass object to derive the topology
    class: builtin-generic-v3.3.0
    #kubernetes version of the cluster; format is TKR NAME
    version: v1.32
    #describe the cluster control plane
    controlPlane:
      #number of control plane nodes
      #integer value 1 or 3
      #NOTE: Production clusters require 3 control plane nodes
      replicas: 1
      # configure labels and annotations on the control plane Machine objects
      # can be used to override the OS to be used for the control plane nodes
      metadata:
        annotations:
          # annotation to choose the OS to use for the control plane nodes          
          # allowed values for the OS name are photon and ubuntu
          # optional
          run.tanzu.vmware.com/resolve-os-image: os-name=photon
          # To run Ubuntu 22.04
#          run.tanzu.vmware.com/resolve-os-image: "os-name=ubuntu,os-version=22.04"
      variables:
        overrides:
        # only include variables whose scope includes control plane
        - name: vmClass
          value: best-effort-medium
    #describe the cluster worker nodes
    workers:
      #specifies parameters for a set of worker nodes in the topology
      machineDeployments:
          # node pool class used to create the set of worker nodes
          # required
        - class: node-pool
          # user-defined name of the node pool; string
          # required
          name: node-pool-1
          # number of worker nodes in this pool; integer 0 or more
          # defaults to 1
          replicas: 2
          metadata:
            annotations:
              # annotation to choose the OS to use for the node pool
              # allowed values for the OS name are photon, ubuntu, windows
              # optional
              run.tanzu.vmware.com/resolve-os-image: os-name=photon
              # To run Ubuntu 22.04
#              run.tanzu.vmware.com/resolve-os-image: "os-name=ubuntu,os-version=22.04"
          variables:
            overrides:
            # only include variables whose scope includes workers
            - name: vmClass
              value: best-effort-medium          
    #customize the cluster
    variables:
      #virtual machine class type and size for cluster nodes
      # Required
      - name: vmClass
        value: best-effort-large
      #persistent storage class for cluster nodes
      # Required
      - name: storageClass
        value: vsan-default-storage-policy